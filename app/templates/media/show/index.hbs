<div class="row">
  {{! Primary Content }}
  <div class="col-sm-8">
    {{! Synopsis }}
    <section class="media-synopsis m-b-1">
      <p>
        {{text-clipper media.synopsis
          length=300
          expandText="Read More"
          collapseText="Read Less"
          options=(hash maxLines=4)}}
      </p>
    </section>

    {{! Ratings }}
    <section class="clearfix">
      {{media/media-rating
        entry=entry
        media=media
        update=(route-action "updateEntry" entry "rating")
      }}
    </section>

    {{! Genres }}
    <section class="media--tags">
      <ul>
        <li><strong>Tags:</strong></li>
        {{#each (sort-by "name" media.genres) as |genre|}}
          <li class="media--category-tag">
            <a href={{href-to (concat (model-type media) ".index") (query-params genres=genre.name)}}>
              {{genre.name}}
            </a>
          </li>
        {{/each}}
      </ul>
    </section>

    {{! Rankings }}
    <section class="media-rankings">
      <span class="ranking">
        {{svg-jar "heart-filled"}}
        Rank #33 (Most Popular Anime)
      </span>
      <span class="ranking">
        {{svg-jar "star"}}
        Rank #9 (Highest Rated Anime)
      </span>
    </section>

    {{! Installments }}
    <section class="media--related">
      <h5>
        Franchise
      </h5>
      <div class="related--panel">
        <div class="related--wrapper">
          <div class="related--title">
            Adaptation:
          </div>
          <div class="related--posters">
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/manga/3/117681.webp" alt="Generic placeholder image">
            </a>
          </div>
        </div>
      </div>

      <div class="related--panel">
        <div class="related--wrapper">
          <div class="related--title">
            Sequel:
          </div>
          <div class="related--posters">
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/5/17407.webp" alt="Generic placeholder image">
            </a>
          </div>
        </div>
      </div>

      <div class="related--panel">
        <div class="related--wrapper">
          <div class="related--title">
            Side Story:
          </div>
          <div class="related--posters">
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/6/76015.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/11/20921.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/12/11240.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/11/76016.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/10/11244.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/6/76017.webp" alt="Generic placeholder image">
            </a>
            <a href="#" class="related--item">
              <img class="media-object" src="https://myanimelist.cdn-dena.com/images/anime/11/27050.webp" alt="Generic placeholder image">
            </a>
          </div>
        </div>
      </div>

    </section>

    {{! Reviews }}
    <section class="m-b-1">
      <h5>Popular Reviews</h5>
      {{#if model.taskInstance.isRunning}}
        <div class="text-xs-center w-100 m-t-1 m-b-1">
          {{loading-spinner size="large"}}
        </div>
      {{else if model.taskInstance.error}}
        <div class="text-xs-center w-100 m-t-1 m-b-1">
          {{t "errors.load"}}
        </div>
      {{else if model.taskInstance.value}}
        <ul class="media-list w-100">
          {{#each model.taskInstance.value as |review|}}
            {{stream-feed/items/review review=review media=media hideImage=true}}
          {{/each}}
        </ul>
      {{else}}
        <div class="m-t-1 m-b-1">
          {{t "errors.contentEmpty"}}
        </div>
      {{/if}}
    </section>
  </div>

  {{! Secondary Content }}
  {{! TODO: Componentize }}
  <div class="col-sm media--sidebar">
    {{! Trailer }}
    {{#if media.youtubeVideoId}}
      <div class="media-preview embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item" width="560" height="315" src="https://www.youtube.com/embed/{{media.youtubeVideoId}}" frameborder="0" allowfullscreen></iframe>
      </div>
    {{/if}}

    {{! Featured Characters }}
    <section class="media--main-characters">
      <div class="favorite-characters-panel">
        <h5>Characters</h5>
        <div class="favorite-media-grid row">
          <div aria-label="Hachiman Hikigaya" class="favorite-item col-sm-3 hint--top hint--bounce hint--rounded">
            <a href="#">
              <img src="https://media.kitsu.io/characters/images/37854/original.jpg?1416238436">
            </a>
          </div>
          <div class="text-xs-center w-100">
            <button class="button button--primary">
              View All
            </button>
          </div>
        </div>
      </div>
    </section>

    {{! Title  Information }}
    <section class="media--alt-titles">
      <h5>Alternative Titles</h5>
      <ul>
        {{#each-in media.titles as |key value|}}
          <li>
            <strong>{{t (concat "media.routes.show.titles." key)}}:</strong>
            {{value}}
          </li>
        {{/each-in}}
        {{#if media.abbreviatedTitles}}
          <li>
            <strong>Synonyms:</strong>
            {{join ", " media.abbreviatedTitles}}
          </li>
        {{/if}}
      </ul>
    </section>

    {{! Media Information }}
    <section class="media--information">
      <h5>Information</h5>
      <ul>
        {{#if media.subtype}}
          <li>
            <strong>Type:</strong>
            {{media.subtype}}
          </li>
        {{/if}}
        {{#if media.episodeCount}}
          <li>
            <strong>Episodes:</strong>
            {{media.episodeCount}}
          </li>
        {{/if}}
        <li>
          <strong>Status:</strong>
          Finished Airing
        </li>
        {{#if media.startDate}}
          <li>
            <strong>Aired:</strong>
            {{moment-format media.startDate "MMM D, YYYY"}}
            {{#if (and media.endDate airedLongerThanOneDay)}}
              to {{moment-format media.endDate "MMM D, YYYY"}}
            {{/if}}
          </li>
          <li>
            {{! TODO!! }}
            <strong>Premiered:</strong>
            <a href={{href-to (concat (model-type media) ".index") (query-params season=season year=seasonYear)}}>
              {{season}} {{seasonYear}}
            </a>
          </li>
        {{/if}}
        {{! No info on these yet }}
        <li>
          <strong>Producers: </strong>
          <a href="#">TV Tokyo</a>, <a href="#">Aniplex</a>
        </li>
        <li>
          <strong>Licensors:</strong>
          <a href="#">Viz Media</a>
        </li>
        <li>
          <strong>Studios:</strong>
          <a href="#">Studio Pierrot</a>
        </li>
        {{#if media.episodeLength}}
          <li>
            <strong>Duration:</strong>
            {{t "media.routes.show.meta.unit.length" total=totalTime length=media.episodeLength count=media.unitCount}}
          </li>
        {{/if}}
        {{#if media.ageRating}}
          <li>
            <strong>Rating:</strong>
            {{media.ageRating}}
            {{#if media.ageRatingGuide}}
              - {{media.ageRatingGuide}}
            {{/if}}
          </li>
        {{/if}}
      </ul>
    </section>
  </div>
</div>


{{! Feed }}
<section>
  <h5>Community Feed</h5>
  {{stream-feed/list
    streamType="media_aggr"
    streamId=(concat (capitalize (model-type media)) "-" media.id)
    streamFilter="user"
    readOnly=(not session.hasUser)
    media=media
  }}
</section>
